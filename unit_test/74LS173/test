DEFINE CUSTOM BLOCK latchHandler (IN d de nde clk clr en OUT q) {
    INSERT BLOCKS
        AND and1 q nde o,
        AND and2 d de o,
        OR or a1 a2 o,
        D_LATCH latch,
        DTS_BUFFER buf;
    INSERT EDGES
        BTWN THIS.d AND and2.d,
        BTWN THIS.de AND and2.de,
        BTWN THIS.nde AND and1.nde,
        BTWN and1.o AND or.a1,
        BTWN and2.o AND or.a2,
        BTWN or.o AND latch.D,
        BTWN THIS.clk AND latch.C,
        BTWN THIS.clr AND latch.R,
        BTWN latch.Q AND and1.q,
        BTWN latch.NQ AND buf.in,
        BTWN THIS.en AND buf.en,
        BTWN buf.out AND THIS.q;
};

/* other necessary pins */

/* data inputs for the latches */


/* the output control pins */
INSERT BLOCKS
    STATE OUT M,
    STATE OUT N,
    NOT notM i o,
    NOT notN i o,
    AND andmn M N o;
INSERT EDGES
    BTWN M.val AND notM.i,
    BTWN N.val AND notN.i,
    BTWN notM.o AND andmn.M,
    BTWN notN.o AND andmn.N;

/* the data enable pins */
INSERT BLOCKS
    STATE OUT ng1,
    STATE OUT ng2,
    NOT notng1 i o,
    NOT notng2 i o,
    AND andg12 g1 g2 o,
    NOT notandg12 i o;
INSERT EDGES
    BTWN ng1.val AND notng1.i,
    BTWN ng2.val AND notng2.i,
    BTWN notng1.o AND andg12.g1,
    BTWN notng2.o AND andg12.g2,
    BTWN andg12.o AND notandg12.i;

/* the blocks where the d latches are located */
/*
INSERT BLOCKS
    CUSTOM latchHandler h1;
INSERT EDGES
    BTWN andmn.o AND h1.en;
*/


